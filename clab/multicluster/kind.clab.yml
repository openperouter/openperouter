name: kind
topology:
  nodes:
    leafA:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - ../frrcommon/daemons:/etc/frr/daemons
        - ../leafA/frr.conf:/etc/frr/frr.conf
        - ../frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - ../leafA/setup.sh:/setup.sh
    leafB:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - ../frrcommon/daemons:/etc/frr/daemons
        - ../leafB/frr.conf:/etc/frr/frr.conf
        - ../frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - ../leafB/setup.sh:/setup.sh
    leafkind-a:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - ../frrcommon/daemons:/etc/frr/daemons
        - ../frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - leafkind-a/frr.conf:/etc/frr/frr.conf
    leafkind-b:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - ../frrcommon/daemons:/etc/frr/daemons
        - ../frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - leafkind-b/frr.conf:/etc/frr/frr.conf
    spine:
      kind: linux
      image: quay.io/frrouting/frr:10.2.1
      binds:
        - ../frrcommon/daemons:/etc/frr/daemons
        - ../frrcommon/vtysh.conf:/etc/frr/vtysh.conf
        - spine/frr.conf:/etc/frr/frr.conf

    hostA_default:
      kind: linux
      image: "k8s.gcr.io/e2e-test-images/agnhost:2.40"
      binds:
        - ../hostA_default/setup.sh:/setup.sh
      cmd: netexec --http-port=8090

    hostA_red:
      kind: linux
      image: "k8s.gcr.io/e2e-test-images/agnhost:2.40"
      binds:
        - ../hostA_red/setup.sh:/setup.sh
      cmd: netexec --http-port=8090

    hostB_red:
      kind: linux
      image: "k8s.gcr.io/e2e-test-images/agnhost:2.40"
      binds:
        - ../hostB_red/setup.sh:/setup.sh
      cmd: netexec --http-port=8090

    hostA_blue:
      kind: linux
      image: "k8s.gcr.io/e2e-test-images/agnhost:2.40"
      binds:
        - ../hostA_blue/setup.sh:/setup.sh
      cmd: netexec --http-port=8090

    hostB_blue:
      kind: linux
      image: "k8s.gcr.io/e2e-test-images/agnhost:2.40"
      binds:
        - ../hostB_blue/setup.sh:/setup.sh
      cmd: netexec --http-port=8090

    leafkind-sw-a:
      kind: bridge

    leafkind-sw-b:
      kind: bridge

    pe-kind-a:
      kind: k8s-kind
      startup-config: ../pe-kind-a-configuration-registry.yaml

    pe-kind-b:
      kind: k8s-kind
      startup-config: ../pe-kind-b-configuration-registry.yaml

    pe-kind-a-control-plane:
      kind: ext-container

    pe-kind-b-control-plane:
      kind: ext-container

    pe-kind-a-worker:
      kind: ext-container

    pe-kind-b-worker:
      kind: ext-container

  links:
    - endpoints: ["leafA:eth1", "spine:eth1"]
    - endpoints: ["leafB:eth1", "spine:eth2"]
    - endpoints: ["leafkind-a:eth1", "spine:eth3"]
    - endpoints: ["leafkind-b:eth1", "spine:eth4"]
    - endpoints: ["leafA:ethred", "hostA_red:eth1"]
    - endpoints: ["leafA:ethdefault", "hostA_default:eth1"]
    - endpoints: ["leafA:ethblue", "hostA_blue:eth1"]
    - endpoints: ["leafB:ethred", "hostB_red:eth1"]
    - endpoints: ["leafB:ethblue", "hostB_blue:eth1"]
    - endpoints: ["leafkind-a:toswitch", "leafkind-sw-a:leaf2"]
    - endpoints: ["leafkind-b:toswitch", "leafkind-sw-b:leaf3"]
    - endpoints: ["pe-kind-a-control-plane:toswitch", "leafkind-sw-a:kindctrlpla"]
    - endpoints: ["pe-kind-b-control-plane:toswitch", "leafkind-sw-b:kindctrlplb"]
    - endpoints: ["pe-kind-a-worker:toswitch", "leafkind-sw-a:kindworkera"]
    - endpoints: ["pe-kind-b-worker:toswitch", "leafkind-sw-b:kindworkerb"]
